<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title></title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi"/>
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
  <link rel="stylesheet" href="devg-monitor/xadmin/css/font.css">
  <link rel="stylesheet" href="devg-monitor/xadmin/css/xadmin.css">
  <script src='devg-monitor/vue.min.js' type='text/javascript'></script>
  <script src='devg-monitor/axios.min.js' type='text/javascript'></script>
</head>
<body>
<div id="monitorCityplatformIndex" class="x-body layui-anim layui-anim-up">
  <fieldset class="layui-elem-field">
    <legend>详情信息</legend>
    <div class="layui-field-box">
      <table class="layui-table">
        <tbody>
        <tr>
          <th>企业名称</th>
          <td>{{ detail.companyName }}</td>
        </tr>
        <tr>
          <th>项目名称</th>
          <td>{{ detail.projectName }}</td>
        </tr>
        <tr>
          <th>报警原因</th>
          <td>{{ detail.warnReason }}</td>
        </tr>
        <tr>
          <th>报警次数</th>
          <td>{{ detail.count }}</td>
        </tr>
        </tbody>
      </table>
    </div>
  </fieldset>
  <fieldset class="layui-elem-field">
    <legend>报警列表统计</legend>
    <div class="layui-field-box">
      <xblock>
        <button @click="searchList(null,'1')" class="layui-btn layui-btn-primary layui-btn-sm">当天</button>
        <button @click="searchList(null,'2')" class="layui-btn layui-btn-primary layui-btn-sm">近7天</button>
        <button @click="searchList(null,'3')" class="layui-btn layui-btn-primary layui-btn-sm">近30天</button>
      </xblock>
      <table class="layui-table">
        <thead>
        <tr>
          <th>企业名称</th>
          <th>项目名称</th>
          <th>报警原因</th>
          <th>报警次数</th>
        </tr>
        </thead>
        <tbody>
        <tr v-for="detail in list">
          <td>{{ detail.companyName }}</td>
          <td>{{ detail.projectName }}</td>
          <td>{{ detail.warnReason }}</td>
          <td style="width:35px;">{{ detail.count }}</td>
        </tr>
        </tbody>
      </table>
    </div>
  </fieldset>
</div>

<script type="text/javascript">
  var app = new Vue({
    el: '#monitorCityplatformIndex',
    data() {
      return {
        list: null,
        detail: {
          "companyName": '',
          "projectName": '',
          "warnType": '',
          "warnReason": '',
          "count": ''
        },
        location: '',
        businessId: null
      }
    },
    mounted() {
      this.location = window.location.href;
      let businessId = this.getQueryVariable("businessId");
      this.businessId = businessId;
      this.searchList(businessId, null);
    },
    methods: {
      async searchList(busId, scopeType) {
        let that = this;
        if (null == busId || '' == busId || typeof (busId) == "undefined") {
          busId = that.businessId;
        }
        let index = that.location.lastIndexOf("?");
        let url = that.location.substring(0, index);
        url = url.replace('monitor-cityplatform-index.html', '');
        url = url + 'devg/monitor/monitorCityplatformSearch';
        let params = {"businessId": busId, "scopeType": scopeType};
        try {
          let res = await axios.post(url, params, {headers: {'Content-Type': 'application/json'}})
          let detailRes = res.data.data.detail;
          if (null != detailRes && typeof (detailRes) != "undefined") {
            that.detail = detailRes;
          }
          that.list = res.data.data.resultList;
        } catch (err) {
          console.log(err)
        }
        /*axios.post(url, params, {headers: {'Content-Type': 'application/json'}})
        .then(response => {
          let detailRes = response.data.data.detail;
          if (null != detailRes && typeof (detailRes) != "undefined") {
            that.detail = detailRes;
          }
          that.list = response.data.data.resultList;
        })
        .catch(function (error) { // 请求失败处理
          console.log(error);
        });*/
      },
      getQueryVariable: function (variable) {
        let query = window.location.search.substring(1);
        let vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
          var pair = vars[i].split("=");
          if (pair[0] == variable) {
            return pair[1];
          }
        }
        return (false);
      }
    }
  })
</script>
</body>
</html>